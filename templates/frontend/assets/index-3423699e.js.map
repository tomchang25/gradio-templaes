{"version":3,"file":"index-3423699e.js","sources":["../../../../js/app/src/components/AnnotatedImage/AnnotatedImage.svelte","../../../../js/app/src/components/AnnotatedImage/index.ts"],"sourcesContent":["<script lang=\"ts\">\r\n\timport { createEventDispatcher } from \"svelte\";\r\n\timport { Block, BlockLabel, Empty } from \"@gradio/atoms\";\r\n\timport { Image } from \"@gradio/icons\";\r\n\timport StatusTracker from \"../StatusTracker/StatusTracker.svelte\";\r\n\timport type { LoadingStatus } from \"../StatusTracker/types\";\r\n\timport { FileData, normalise_file } from \"@gradio/upload\";\r\n\timport type { SelectData } from \"@gradio/utils\";\r\n\timport type { Styles } from \"@gradio/utils\";\r\n\r\n\texport let elem_id: string = \"\";\r\n\texport let elem_classes: Array<string> = [];\r\n\texport let visible: boolean = true;\r\n\texport let value: [FileData, Array<[FileData, string]>] | null;\r\n\tlet old_value: [FileData, Array<[FileData, string]>] | null;\r\n\tlet _value: [FileData, Array<[FileData, string]>] | null;\r\n\texport let label: string = \"Annotated Image\";\r\n\texport let show_label: boolean = true;\r\n\texport let show_legend: boolean = true;\r\n\texport let style: Styles = {};\r\n\texport let root: string;\r\n\texport let root_url: string;\r\n\tlet active: string | null = null;\r\n\r\n\texport let loading_status: LoadingStatus;\r\n\r\n\tconst dispatch = createEventDispatcher<{\r\n\t\tchange: undefined;\r\n\t\tselect: SelectData;\r\n\t}>();\r\n\r\n\t$: {\r\n\t\tif (value !== old_value) {\r\n\t\t\told_value = value;\r\n\t\t\tdispatch(\"change\");\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\t_value = [\r\n\t\t\t\tnormalise_file(value[0], root, root_url) as FileData,\r\n\t\t\t\tvalue[1].map(([file, label]) => [\r\n\t\t\t\t\tnormalise_file(file, root, root_url) as FileData,\r\n\t\t\t\t\tlabel\r\n\t\t\t\t])\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\t_value = null;\r\n\t\t}\r\n\t}\r\n\tfunction handle_mouseover(label: string) {\r\n\t\tactive = label;\r\n\t}\r\n\tfunction handle_mouseout() {\r\n\t\tactive = null;\r\n\t}\r\n\r\n\tconst FIXED_HEIGHT = 240;\r\n</script>\r\n\r\n<Block\r\n\t{visible}\r\n\t{elem_id}\r\n\t{elem_classes}\r\n\tpadding={false}\r\n\tstyle={{\r\n\t\theight: style.height || FIXED_HEIGHT,\r\n\t\twidth: style.width\r\n\t}}\r\n>\r\n\t<StatusTracker {...loading_status} />\r\n\t<BlockLabel {show_label} Icon={Image} label={label || \"Image\"} />\r\n\r\n\t<div class=\"container\">\r\n\t\t{#if _value == null}\r\n\t\t\t<Empty size=\"large\" unpadded_box={true}><Image /></Empty>\r\n\t\t{:else}\r\n\t\t\t<div class=\"image-container\">\r\n\t\t\t\t<!-- svelte-ignore a11y-missing-attribute -->\r\n\t\t\t\t<img class=\"base-image\" src={_value ? _value[0].data : null} />\r\n\t\t\t\t{#each _value ? _value[1] : [] as [file, label], i}\r\n\t\t\t\t\t<!-- svelte-ignore a11y-missing-attribute -->\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclass=\"mask\"\r\n\t\t\t\t\t\tclass:active={active == label}\r\n\t\t\t\t\t\tclass:inactive={active != label && active != null}\r\n\t\t\t\t\t\tsrc={file.data}\r\n\t\t\t\t\t\tstyle={style.color_map && label in style.color_map\r\n\t\t\t\t\t\t\t? null\r\n\t\t\t\t\t\t\t: `filter: hue-rotate(${Math.round(\r\n\t\t\t\t\t\t\t\t\t(i * 360) / _value[1].length\r\n\t\t\t\t\t\t\t  )}deg);`}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{/each}\r\n\t\t\t</div>\r\n\t\t\t{#if show_legend && _value}\r\n\t\t\t\t<div class=\"legend\">\r\n\t\t\t\t\t{#each _value[1] as [_, label], i}\r\n\t\t\t\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"legend-item\"\r\n\t\t\t\t\t\t\tstyle=\"background-color: {style.color_map &&\r\n\t\t\t\t\t\t\tlabel in style.color_map\r\n\t\t\t\t\t\t\t\t? style.color_map[label] + '88'\r\n\t\t\t\t\t\t\t\t: `hsla(${Math.round(\r\n\t\t\t\t\t\t\t\t\t\t(i * 360) / _value[1].length\r\n\t\t\t\t\t\t\t\t  )}, 100%, 50%, 0.3)`}\"\r\n\t\t\t\t\t\t\ton:mouseover={() => handle_mouseover(label)}\r\n\t\t\t\t\t\t\ton:focus={() => handle_mouseover(label)}\r\n\t\t\t\t\t\t\ton:mouseout={() => handle_mouseout()}\r\n\t\t\t\t\t\t\ton:blur={() => handle_mouseout()}\r\n\t\t\t\t\t\t\ton:click={() => dispatch(\"select\", { index: i, value: label })}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t{/if}\r\n\t</div>\r\n</Block>\r\n\r\n<style>\r\n\t.container {\r\n\t\tdisplay: flex;\r\n\t\tposition: relative;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\twidth: var(--size-full);\r\n\t\theight: var(--size-full);\r\n\t}\r\n\t.image-container {\r\n\t\tposition: relative;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tflex-grow: 1;\r\n\t\twidth: 100%;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t.image-container img {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tobject-fit: contain;\r\n\t}\r\n\t.mask {\r\n\t\topacity: 0.85;\r\n\t\ttransition: all 0.2s ease-in-out;\r\n\t}\r\n\t.image-container:hover .mask {\r\n\t\topacity: 0.3;\r\n\t}\r\n\t.mask.active {\r\n\t\topacity: 1;\r\n\t}\r\n\t.mask.inactive {\r\n\t\topacity: 0;\r\n\t}\r\n\t.legend {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tflex-wrap: wrap;\r\n\t\talign-content: center;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tgap: var(--spacing-sm);\r\n\t\tpadding: var(--spacing-sm);\r\n\t}\r\n\t.legend-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tcursor: pointer;\r\n\t\tborder-radius: var(--radius-sm);\r\n\t\tpadding: var(--spacing-sm);\r\n\t}\r\n</style>\r\n","export { default as Component } from \"./AnnotatedImage.svelte\";\r\nexport const modes = [\"static\"];\r\n\r\nexport const document = (config: Record<string, any>) => ({\r\n\ttype: {\r\n\t\tpayload: \"[string, Array<[string, string]>]\"\r\n\t},\r\n\tdescription: {\r\n\t\tpayload:\r\n\t\t\t\"path to base image, followed by a list of tuples [mask image path, label]\"\r\n\t}\r\n});\r\n"],"names":["ctx","i","if_block","create_if_block_1","src_url_equal","img","img_src_value","attr","insert","target","div","anchor","append","dirty","img_style_value","toggle_class","each_value","set_style","set_data","t0","t0_value","Image","blocklabel_changes","FIXED_HEIGHT","elem_id","$$props","elem_classes","visible","value","old_value","_value","label","show_label","show_legend","style","root","root_url","active","loading_status","dispatch","createEventDispatcher","handle_mouseover","$$invalidate","handle_mouseout","mouseover_handler","focus_handler","normalise_file","file","modes","document","config"],"mappings":"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"}