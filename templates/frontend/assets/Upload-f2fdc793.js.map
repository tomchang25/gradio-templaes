{"version":3,"file":"Upload-f2fdc793.js","sources":["../../../../js/upload/src/Upload.svelte"],"sourcesContent":["<script lang=\"ts\">\r\n\timport { createEventDispatcher } from \"svelte\";\r\n\timport type { FileData } from \"./types\";\r\n\timport { blobToBase64 } from \"./utils\";\r\n\r\n\texport let filetype: string | null = null;\r\n\texport let include_file_metadata = true;\r\n\texport let dragging = false;\r\n\texport let boundedheight: boolean = true;\r\n\texport let center: boolean = true;\r\n\texport let flex: boolean = true;\r\n\texport let file_count: string = \"single\";\r\n\texport let disable_click = false;\r\n\texport let parse_to_data_url = true;\r\n\r\n\tlet hidden_upload: HTMLInputElement;\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tconst updateDragging = () => {\r\n\t\tdragging = !dragging;\r\n\t};\r\n\r\n\tconst openFileUpload = () => {\r\n\t\tif (disable_click) return;\r\n\t\thidden_upload.value = \"\";\r\n\t\thidden_upload.click();\r\n\t};\r\n\r\n\tconst loadFiles = async (files: FileList) => {\r\n\t\tlet _files: Array<File> = Array.from(files);\r\n\t\tif (!files.length || !window.FileReader) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (file_count === \"single\") {\r\n\t\t\t_files = [files[0]];\r\n\t\t}\r\n\r\n\t\tif (include_file_metadata) {\r\n\t\t\tvar file_metadata: Array<{ name: string; size: number }> = _files.map(\r\n\t\t\t\t(f) => ({\r\n\t\t\t\t\tname: f.name,\r\n\t\t\t\t\tsize: f.size\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar load_file_data = [];\r\n\t\tvar file_data: Array<string> | Array<File> = [];\r\n\t\tif (parse_to_data_url) {\r\n\t\t\tfile_data = await Promise.all(_files.map((f) => blobToBase64(f)));\r\n\t\t} else {\r\n\t\t\tfile_data = _files;\r\n\t\t}\r\n\t\tif (include_file_metadata) {\r\n\t\t\tif (parse_to_data_url) {\r\n\t\t\t\tload_file_data = file_data.map((data, i) => ({\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\t...file_metadata[i]\r\n\t\t\t\t}));\r\n\t\t\t} else {\r\n\t\t\t\tload_file_data = file_data.map((data, i) => ({\r\n\t\t\t\t\tdata: \"\",\r\n\t\t\t\t\tblob: data,\r\n\t\t\t\t\t...file_metadata[i]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tload_file_data = file_data;\r\n\t\t}\r\n\t\tdispatch(\r\n\t\t\t\"load\",\r\n\t\t\tfile_count === \"single\" ? load_file_data[0] : load_file_data\r\n\t\t);\r\n\t};\r\n\r\n\tconst loadFilesFromUpload = async (e: Event) => {\r\n\t\tconst target = e.target as HTMLInputElement;\r\n\r\n\t\tif (!target.files) return;\r\n\t\tawait loadFiles(target.files);\r\n\t};\r\n\r\n\tconst loadFilesFromDrop = async (e: DragEvent) => {\r\n\t\tdragging = false;\r\n\t\tif (!e.dataTransfer?.files) return;\r\n\t\tawait loadFiles(e.dataTransfer.files);\r\n\t};\r\n</script>\r\n\r\n<div\r\n\tclass:center\r\n\tclass:boundedheight\r\n\tclass:flex\r\n\ton:drag|preventDefault|stopPropagation\r\n\ton:dragstart|preventDefault|stopPropagation\r\n\ton:dragend|preventDefault|stopPropagation\r\n\ton:dragover|preventDefault|stopPropagation\r\n\ton:dragenter|preventDefault|stopPropagation\r\n\ton:dragleave|preventDefault|stopPropagation\r\n\ton:drop|preventDefault|stopPropagation\r\n\ton:click={openFileUpload}\r\n\ton:drop={loadFilesFromDrop}\r\n\ton:dragenter={updateDragging}\r\n\ton:dragleave={updateDragging}\r\n>\r\n\t<slot />\r\n\t<input\r\n\t\ttype=\"file\"\r\n\t\tbind:this={hidden_upload}\r\n\t\ton:change={loadFilesFromUpload}\r\n\t\taccept={filetype}\r\n\t\tmultiple={file_count === \"multiple\" || undefined}\r\n\t\twebkitdirectory={file_count === \"directory\" || undefined}\r\n\t\tmozdirectory={file_count === \"directory\" || undefined}\r\n\t/>\r\n</div>\r\n\r\n<style>\r\n\tdiv {\r\n\t\tcursor: pointer;\r\n\t\twidth: var(--size-full);\r\n\t\theight: var(--size-full);\r\n\t}\r\n\r\n\t.center {\r\n\t\ttext-align: center;\r\n\t}\r\n\t.flex {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\tinput {\r\n\t\tdisplay: none;\r\n\t}\r\n</style>\r\n"],"names":["ctx","insert","target","div","anchor","append","input","filetype","$$props","include_file_metadata","dragging","boundedheight","center","flex","file_count","disable_click","parse_to_data_url","hidden_upload","dispatch","createEventDispatcher","updateDragging","$$invalidate","openFileUpload","loadFiles","files","_files","file_metadata","f","load_file_data","file_data","blobToBase64","data","i","loadFilesFromUpload","loadFilesFromDrop","$$value"],"mappings":"+aA8GUA,EAAQ,CAAA,CAAA,eACNA,EAAU,CAAA,IAAK,YAAc,+BACtBA,EAAU,CAAA,IAAK,aAAe,MAAS,uBAC1CA,EAAU,CAAA,IAAK,aAAe,MAAS,oIAxBvDC,EA0BMC,EAAAC,EAAAC,CAAA,wBATLC,EAQEF,EAAAG,CAAA,oCALUN,EAAmB,CAAA,CAAA,4MATrBA,EAAc,CAAA,CAAA,aACfA,EAAiB,CAAA,CAAA,kBACZA,EAAc,CAAA,CAAA,kBACdA,EAAc,CAAA,CAAA,mHAOnBA,EAAQ,CAAA,CAAA,oBACNA,EAAU,CAAA,IAAK,YAAc,2CACtBA,EAAU,CAAA,IAAK,aAAe,qDACjCA,EAAU,CAAA,IAAK,aAAe,4QA5GlC,CAAA,SAAAO,EAA0B,IAAI,EAAAC,EAC9B,CAAA,sBAAAC,EAAwB,EAAI,EAAAD,EAC5B,CAAA,SAAAE,EAAW,EAAK,EAAAF,EAChB,CAAA,cAAAG,EAAyB,EAAI,EAAAH,EAC7B,CAAA,OAAAI,EAAkB,EAAI,EAAAJ,EACtB,CAAA,KAAAK,EAAgB,EAAI,EAAAL,EACpB,CAAA,WAAAM,EAAqB,QAAQ,EAAAN,EAC7B,CAAA,cAAAO,EAAgB,EAAK,EAAAP,EACrB,CAAA,kBAAAQ,EAAoB,EAAI,EAAAR,EAE/BS,EAEE,MAAAC,EAAWC,KAEXC,EAAc,IAAA,CACnBC,EAAA,GAAAX,GAAYA,CAAQ,GAGfY,EAAc,IAAA,CACfP,QACJE,EAAc,MAAQ,GAAEA,CAAA,EACxBA,EAAc,MAAK,IAGdM,QAAmBC,GAAe,CACnC,IAAAC,EAAsB,MAAM,KAAKD,CAAK,EACrC,GAAA,GAAAA,EAAM,QAAW,CAAA,OAAO,gBAGzBV,IAAe,WAClBW,EAAM,CAAID,EAAM,CAAC,CAAA,GAGdf,EACC,IAAAiB,EAAuDD,EAAO,IAChEE,IACA,CAAA,KAAMA,EAAE,KACR,KAAMA,EAAE,IAAI,EAAA,MAIXC,EAAc,CAAA,EACdC,EAAS,CAAA,EACTb,EACHa,EAAkB,MAAA,QAAQ,IAAIJ,EAAO,IAAKE,GAAMG,GAAaH,CAAC,CAAA,CAAA,EAE9DE,EAAYJ,EAEThB,EACCO,EACHY,EAAiBC,EAAU,IAAK,CAAAE,EAAMC,KACrC,CAAA,KAAAD,EACG,GAAAL,EAAcM,CAAC,CAAA,EAAA,EAGnBJ,EAAiBC,EAAU,IAAK,CAAAE,EAAMC,KAAC,CACtC,KAAM,GACN,KAAMD,EACH,GAAAL,EAAcM,CAAC,KAIpBJ,EAAiBC,EAElBX,EACC,OACAJ,IAAe,SAAWc,EAAe,CAAC,EAAIA,CAAc,IAIxDK,QAA6B,GAAQ,OACpC/B,EAAS,EAAE,OAEZA,EAAO,aACNqB,EAAUrB,EAAO,KAAK,GAGvBgC,QAA2B,GAAY,CAC5Cb,EAAA,GAAAX,EAAW,EAAK,EACX,EAAE,cAAc,OACf,MAAAa,EAAU,EAAE,aAAa,KAAK,sQAuBzBN,EAAakB"}